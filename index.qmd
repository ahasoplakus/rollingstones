---
title: "Greatest Albums of All Time"
title-block-banner: rstones.png
author: Sukalpo Saha
date: today
---

```{css}
#| echo: false
body {
  background-color: #fff2d780 !important;
}

.quarto-title-block .quarto-title-banner {
  background-size: 20% !important;
  background-repeat: no-repeat !important;
  background-color: #fff2d780 !important;
}

.quarto-title .title {
  color: #c61a09;
  font-weight: 800;
  font-size: xxx-large;
}

.quarto-title-meta {
  color: #c61a09;
  font-weight: 800;
  font-size: large;
}
```

```{r}
#| echo: false
#| message: false
#| warning: false

library(readr)
library(dplyr)
library(stringr)
library(gt)
library(gtExtras)
```

```{r}
#| message: false
#| echo: false
rolling_stone <- read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2024/2024-05-07/rolling_stone.csv')
```

```{r, results='asis'}
#| echo: false
df_albums <- rolling_stone |>
  mutate(Genre = if_else(is.na(genre), "Other", genre)) |>
  filter(if_any(ends_with("2020"), \(x) x <= 50)) |>
  select(
    "Genre" = "Genre",
    "Artist" = "clean_name",
    "Name" = "album",
    "Release Year" = "release_year",
    contains("rank"),
    "Change (2003-2020)" = "differential",
    "Peak Position" = "peak_billboard_position",
    "Weeks on Billboard" = "weeks_on_billboard",
    "Popularity" = "spotify_popularity",
    "URL" = "album_id",
  ) |>
  mutate(URL = paste0("https://open.spotify.com/album/", URL)) |>
  arrange(across(ends_with("2020"))) |>
  rename_with(
    .cols = contains("rank"),
    .fn = \(x) str_to_title(paste0(str_replace_all(x, "_", "<br>("), ")"))
  )

df_albums |>
  gt() |>
  gt_plt_bar(
    column = "Weeks on Billboard",
    color = "#322C2B",
    keep_column = FALSE,
    width = 60,
    scale_type = "number"
    ) |>
  gt_fa_rank_change(
    column = contains("Change"),
    font_color = "match",
    fa_type = "arrow",
    palette = c("green", "grey", "red")
  ) |>
  cols_label_with(
    columns = 5:7,
    fn = \(x) md(x)
  ) |>
  cols_label_with(
    columns = "Popularity",
    fn = \(x) md(paste0(x, "<br>Index"))
  ) |>
  tab_spanner(
    columns = 1:4,
    label = html(local_image(filename = "music-album.png", height = 50)),
    id = "album"
  ) |>
  tab_spanner(
    columns = 5:8,
    label = html(local_image(filename = "rstones.png", height = 50)),
    id = "rstones"
  ) |>
  tab_spanner(
    columns = 9:10,
    label = html(local_image(filename = "billboard.png", height = 50)),
    id = "billboard"
  ) |>
  tab_spanner(
    columns = 11:12,
    label = html(local_image(filename = "spotify.png", height = 50)),
    id = "spotify"
  ) |>
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_body(columns = is.numeric)
  ) |>
  tab_style(
    style = cell_text(align = "center", weight = "bold", color = "#EEEEEE", font = "Ubuntu"),
    locations = cells_column_labels()
  ) |>
   tab_style(
    style = cell_fill(color = "#e95420"),
    locations = cells_column_labels()
  ) |>
  tab_style(
    style = cell_fill(color = "#fff2d780"),
    locations = cells_column_spanners()
  ) |>
  tab_style(
    style = cell_fill(color = "#fff2d780"),
    locations = cells_title()
  ) |>
  tab_style(
    style = cell_fill(color = "#fff2d780"),
    locations = cells_source_notes()
  ) |>
  tab_style(
    style = cell_text(color = "#c61a09"),
    locations = cells_title()
  ) |>
  tab_style(
    style = cell_text(color = "#c61a09"),
    locations = cells_source_notes()
  ) |>
  tab_style(
    style = cell_text(align = "center", weight = "bold"),
    locations = cells_column_spanners()
  ) |>
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_row_groups()
  ) |>
  tab_style(
    style = cell_text(color = "#1DB954", weight = "bold"),
    locations = cells_body(columns = 11)
  ) |>
  tab_style(
    style = cell_fill(color = "#fff2d780"),
    locations = cells_body(columns = c(8, 10, 12))
  ) |>
  tab_style(
    style = cell_fill(color = "#000000"),
    locations = cells_body(columns = 11)
  ) |>
  tab_style(
    style = cell_borders(sides = "right", weight = px(1), color = "#D3D3D3", style = "solid"),
    locations = cells_column_labels()
  ) |>
  tab_style(
    style = cell_borders(sides = c("top", "bottom"), weight = px(2), color = "#e95420", style = "solid"),
    locations = cells_column_labels()
  ) |>
  tab_style(
    style = cell_borders(sides = "right", weight = px(1), color = "#e95420", style = "solid"),
    locations = cells_column_spanners(spanners = c("album", "rstones", "billboard"))
  ) |>
  tab_style(
    style = cell_borders(sides = "bottom", weight = px(2), color = "#e95420", style = "solid"),
    locations = cells_title()
  ) |>
  tab_style(
    style = cell_borders(sides = "top", style = "hidden"),
    locations = cells_title()
  ) |>
  data_color(
    columns = "Genre",
    direction = "column",
    target_columns = c(1:4),
    palette = "wesanderson::Chevalier1",
    na_color = "white"
  ) |>
  data_color(
    columns = 5:7,
    palette = "Redmonder::sPBIRd",
    direction = "column",
    method = "numeric",
    na_color = "white"
  ) |>
  data_color(
    columns = 9,
    palette = c("#fff2d780", "#322C2B"),
    method = "numeric",
    na_color = "white"
  ) |>
  sub_missing(
    columns = contains("Rank"),
    missing_text = "Outside Top 500"
  ) |>
  sub_missing(
    columns = contains("Popularity"),
    missing_text = "Not Featured"
  ) |>
  fmt_url(columns = 12, as_button = TRUE, color = "#1DB954", button_fill = "#000000") |>
  cols_width(
    contains("Release") ~ px(80),
    is.numeric ~ px(80),
    everything() ~ px(150)
  ) |>
  tab_header(
    title = "Album Rankings",
    subtitle = md("*Top 50 Albums based on latest release in 2020*")
  ) |>
  tab_source_note("Sourced from https://github.com/rfordatascience/tidytuesday") |>
  tab_options(
    data_row.padding = px(18),
    table.font.size = px(16L),
  ) |>
  gt_theme_espn() |>
  opt_table_outline(width = px(2), color = "#e95420") |>
  opt_css(
    css = "
    .gt_table {
      width: max-content !important;
    }
    .gt_heading {
      font-family: 'Ubuntu' !important;
      font-weight: 900 !important;
    }
    "
  )
```
